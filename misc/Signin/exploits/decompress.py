import os
import random
import subprocess

input_file = 'flag'

def get_compressed_type(filepath: str) -> str:
    # use file command
    cmd = ['file', filepath]
    file_cmd_output = subprocess.run(cmd, stdout=subprocess.PIPE).stdout.decode().strip()
    if 'gzip compressed data' in file_cmd_output:
        return 'gzip'

    if 'XZ compressed data' in file_cmd_output:
        return 'xz'

    if 'bzip2 compressed data' in file_cmd_output:
        return 'bzip2'

    if 'LZMA compressed data' in file_cmd_output:
        return 'lzma'

    if 'Zstandard compressed data' in file_cmd_output:
        return 'zstd'

    return ''

while True:
    ctype = get_compressed_type(input_file)
    if ctype == "gzip":
        tmp_file = input_file + ".gz"
        cmd = "mv {} {}; gunzip {}".format(input_file, tmp_file, tmp_file)
    elif ctype == "xz":
        tmp_file = input_file + ".xz"
        cmd = "mv {} {}; unxz {}".format(input_file, tmp_file, tmp_file)
    elif ctype == "bzip2":
        tmp_file = input_file + ".bz2"
        cmd = "mv {} {}; bunzip2 {}".format(input_file, tmp_file, tmp_file)
    elif ctype == "lzma":
        tmp_file = input_file + ".lzma"
        cmd = "mv {} {}; unlzma {}".format(input_file, tmp_file, tmp_file)
    elif ctype == "zstd":
        tmp_file = input_file + ".zst"
        cmd = "mv {} {}; unzstd --force {}".format(input_file, tmp_file, tmp_file)
    else:
        print("done")
        break
    os.system(cmd)
